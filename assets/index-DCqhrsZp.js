const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-BQQQa1dv.js","./vendor-IdO53NNW.js","./index-wQ-dAj8X.css"])))=>i.map(i=>d[i]);
var A=Object.defineProperty;var R=(i,o,c)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:c}):i[o]=c;var p=(i,o,c)=>R(i,typeof o!="symbol"?o+"":o,c);import{d as P,P as $,a as b,o as E,c as v,b as z,u as F,e as w,R as N,r as q,f as y,g as B,h as V,i as U,j as W,H as x,k,l as O,m as j,n as D,p as Y,q as K}from"./vendor-IdO53NNW.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const h of n)if(h.type==="childList")for(const u of h.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function c(n){const h={};return n.integrity&&(h.integrity=n.integrity),n.referrerPolicy&&(h.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?h.credentials="include":n.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function r(n){if(n.ep)return;n.ep=!0;const h=c(n);fetch(n.href,h)}})();const H=P("color-scheme",{state(){return window.matchMedia("(prefers-color-scheme: dark)").matches?{colorScheme:"dark"}:{colorScheme:"light"}},getters:{currScheme(){return this.colorScheme}},actions:{switch(i){this.colorScheme=i}}}),I=P("browser-info",{state(){return{isInit:!1,browser:{}}},actions:{init(){$.getInfo().then(i=>{Object.keys(i).forEach(o=>{this.browser[o]=i[o]}),this.isInit=!0})}}}),X={class:"app-box"},G=b({__name:"App",setup(i){return I().init(),E(()=>{document.body.addEventListener("touchmove",function(c){c.preventDefault()},{passive:!1})}),(c,r)=>(w(),v("div",X,[z(F(N))]))}}),S=(i,o)=>{const c=i.__vccOpts||i;for(const[r,n]of o)c[r]=n;return c},J=S(G,[["__scopeId","data-v-4e7930b0"]]),Q="modulepreload",Z=function(i,o){return new URL(i,o).href},M={},ee=function(o,c,r){let n=Promise.resolve();if(c&&c.length>0){const u=document.getElementsByTagName("link"),d=document.querySelector("meta[property=csp-nonce]"),g=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));n=Promise.allSettled(c.map(f=>{if(f=Z(f,r),f in M)return;M[f]=!0;const m=f.endsWith(".css"),e=m?'[rel="stylesheet"]':"";if(!!r)for(let a=u.length-1;a>=0;a--){const l=u[a];if(l.href===f&&(!m||l.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${f}"]${e}`))return;const s=document.createElement("link");if(s.rel=m?"stylesheet":Q,m||(s.as="script"),s.crossOrigin="",s.href=f,g&&s.setAttribute("nonce",g),document.head.appendChild(s),m)return new Promise((a,l)=>{s.addEventListener("load",a),s.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${f}`)))})}))}function h(u){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=u,window.dispatchEvent(d),!d.defaultPrevented)throw u}return n.then(u=>{for(const d of u||[])d.status==="rejected"&&h(d.reason);return o().catch(h)})},L=P("loader-assets-to-blobs",{state(){return{_running:!1,tmpSet:new Set,blobMap:new Map,loading:0}},getters:{isInit(){return!!this.blobMap.size},isRunning(){return this._running},isFinish(){return!this.tmpSet.size},progress(){return{len:this.tmpSet.size+this.blobMap.size,left:this.tmpSet.size,loading:this.loading}}},actions:{_addAssetsToBlobAsync(i){const o=this,c=new XMLHttpRequest;c.open("GET",i,!0),c.responseType="blob",c.onload=function(){if(o.loading-=1,this.status==200){const n=this.response;o._loadSuccess(i,n)}else o._loadError(i,"Error")};let r=0;c.onprogress=n=>{this.loading+=(n.loaded-r)/n.total,r=n.loaded},c.ontimeout=function(){o._loadError(i,"Timeout!")},c.send()},_loadSuccess(i,o){this.tmpSet.delete(i),this.blobMap.set(i,URL.createObjectURL(o))},_loadError(i,o){console.warn(`load Assets Error: ${o}, url: ${i}`)},addAssets(i){this.tmpSet.add(i)},getAssets(i){const o=this.blobMap.get(i);return o||""},startLoad(){return this.isRunning?0:(this._running=!1,this.tmpSet.forEach(i=>{this._addAssetsToBlobAsync(i)}),this._running=!0,1)}}});class te{constructor(){p(this,"uploadLength",0);p(this,"uploadProgress",0)}strSplice(o="",c=1024*1024){let r=[];for(let n=0,h=o.length;n<h/c;n++){const u=o.slice(c*n,c*(n+1));r.push(u)}return r}offlineSave(o,c){try{this.uploadLength=0,this.uploadProgress=0;const r=new Blob([o],{type:"text/plain"});let n="";typeof window.webkitURL<"u"?n=window.webkitURL.createObjectURL(r):n=window.URL.createObjectURL(r);const h=document.createElement("a");return h.id="jspsych-download-as-text-link",h.style.display="none",h.download=`${c}.csv`,h.href=n,h.click(),this.uploadProgress=1,this.uploadLength=1,!0}catch{return!1}}async onlineSave(o,c){this.uploadLength=0,this.uploadProgress=0;let r=0,n=await fetch(`./data/origin/${c}_${r}.csv`,{method:"get"});for(;n.status==200;)r++,n=await fetch(`./data/origin/${c}_${r}.csv`,{method:"get"});const h=this.strSplice(o);this.uploadLength=h.length;for(let u=0;u<this.uploadLength;u++)if((await fetch("./data/upload.php",{method:"post",headers:{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"},body:`data=${h[u]}&id=${c}_${r}`})).status==200)this.uploadProgress+=1;else return!1;return!0}}function se(){let i=new Date().getTime(),o=typeof performance<"u"&&performance.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,c=>{let r=Math.random()*16;return i>0?(r=(i+r)%16|0,i=Math.floor(i/16)):(r=(o+r)%16|0,o=Math.floor(o/16)),(c==="x"?r:r&3|8).toString(16)})}const oe={class:"free-sort-box"},ie={class:"button-box"},ne=b({__name:"freeSort",props:{roleName:{type:Array,default:["baby","man","monster","short","tall"]}},emits:["endTrial","dragEvent"],setup(i,{emit:o}){const c=L(),r=i,n=o,h=q(!1);class u{constructor(e,t){p(this,"dom");p(this,"imgs");p(this,"radius");p(this,"strokeOpts");const s=[];t.forEach(l=>{const _=new Image;_.src=c.getAssets(`./assets/cro_minion/${l}.jpg`),_.onload=()=>{s.push({name:l,pos:{x:0,y:0},size:{width:_.width/10,height:_.height/10},domObj:_,isChoose:!1,chooseOffset:{x:0,y:0},isEnd:!1}),s.length==t.length&&this.initFunc()}});const a={strokeStyle:"#fff",lineWidth:1};this.dom=e,this.imgs=s,this.radius=250,this.strokeOpts=a}initFunc(){this.reset_canvas_size(),this.reset_img_pos(),this.imgs.forEach(e=>{e.isChoose=!1,e.isEnd=!1})}reset_canvas_size(){const e=this.dom.parentElement;this.dom.width=e.clientWidth,this.dom.height=e.clientHeight}reset_img_pos(){const e=this.imgs.length;for(let t=0;t<e;t++){const s=Math.PI*2/e*t-Math.PI/2;this.imgs[t].pos.x=Math.round(Math.cos(s)*(this.radius+80)+this.dom.width/2),this.imgs[t].pos.y=Math.round(Math.sin(s)*(this.radius+80)+this.dom.height/2)}}render_bg(e){e.beginPath(),e.arc(this.dom.width/2,this.dom.height/2,this.radius,0,Math.PI*2),e.fillStyle="#999",e.fill(),e.lineWidth=this.strokeOpts.lineWidth,e.strokeStyle=this.strokeOpts.strokeStyle,e.stroke(),e.closePath()}render_img(e){this.imgs.forEach(t=>{e.drawImage(t.domObj,0,0,t.domObj.width,t.domObj.height,t.pos.x-t.size.width/2,t.pos.y-t.size.height/2,t.size.width,t.size.height)})}render(){const e=this.dom.getContext("2d");e.clearRect(0,0,this.dom.width,this.dom.height),this.render_bg(e),this.render_img(e),window.requestAnimationFrame(()=>{this.render()})}get_activate_img(e){const t=[];return this.imgs.forEach(s=>{const a=Math.abs(e.x-s.pos.x),l=Math.abs(e.y-s.pos.y);a<s.size.width/2&&l<s.size.height/2&&t.push(s)}),t}onmouse(e,t){e=="up"?(this.strokeOpts.strokeStyle="#000",this.strokeOpts.lineWidth=1,this.imgs.forEach(s=>{s.isChoose&&n("dragEvent",{name:s.name,posX:s.pos.x,posY:s.pos.y}),s.isChoose=!1})):e=="down"?this.get_activate_img(t).forEach(s=>{const a=Math.abs(t.x-s.pos.x),l=Math.abs(t.y-s.pos.y);s.isChoose=!0,s.chooseOffset={x:t.x<s.pos.x?-a:a,y:t.y<s.pos.y?-l:l}}):e=="move"&&this.imgs.forEach(s=>{if(s.isChoose){s.pos={x:t.x-s.chooseOffset.x,y:t.y-s.chooseOffset.y};const a=Math.pow(Math.pow(s.pos.x-this.dom.width/2,2)+Math.pow(s.pos.y-this.dom.height/2,2),.5);this.strokeOpts.lineWidth=5,a<this.radius?(s.isEnd=!0,this.strokeOpts.strokeStyle="#0f0"):(s.isEnd=!1,this.strokeOpts.strokeStyle="#f00"),this.can_end()}})}can_end(){let e=!1;this.imgs.forEach(t=>{t.isEnd||(e=!0)}),e?h.value=!1:h.value=!0}submit(){const e=[];return this.imgs.forEach(t=>{e.push({name:t.name,posX:t.pos.x,posY:t.pos.y})}),e}}let d;const g=()=>{n("endTrial",d.submit())},f=()=>{d.initFunc(),d.can_end()};return E(()=>{const m=document.querySelector("canvas");d=new u(m,r.roleName),d.render();const e=t=>{const{top:s,left:a}=m.getBoundingClientRect(),{clientX:l,clientY:_}=t;return{y:_-s,x:l-a}};m.addEventListener("mousedown",t=>{d.onmouse("down",e(t))}),m.addEventListener("mouseup",t=>{d.onmouse("up",e(t))}),m.addEventListener("mousemove",t=>{d.onmouse("move",e(t))})}),(m,e)=>(w(),v("div",oe,[e[0]||(e[0]=y("canvas",null,null,-1)),y("div",ie,[h.value?(w(),v("div",{key:0,onClick:g},"继续")):B("",!0),y("div",{onClick:f},"重置")])]))}}),re=S(ne,[["__scopeId","data-v-6d767c15"]]),ae={class:"free-line-box"},ce=b({__name:"freeLine",props:{trials:{}},emits:["endTrial"],setup(i,{emit:o}){const c=L(),r=i,n=o;class h{constructor(e){p(this,"keys");p(this,"val");const t=[];e.forEach(()=>{const s=[];e.forEach(()=>{s.push(0)}),t.push(s)}),this.keys=e,this.val=t}reset(){const e=[];this.keys.forEach(()=>{const t=[];this.keys.forEach(()=>{t.push(0)}),e.push(t)}),this.val=e}setVal(e,t,s){const a=this.keys.indexOf(e),l=this.keys.indexOf(t);if(a<0||l<0||a==l)return 0;a>l?this.val[a][l]=s:this.val[l][a]=s}getVal(e,t){const s=this.keys.indexOf(e),a=this.keys.indexOf(t);return s<0||a<0?0:s>a?this.val[s][a]:this.val[a][s]}}class u{constructor(e){p(this,"dom");p(this,"radius");p(this,"imgs");p(this,"mousePos");p(this,"data");const t=[],s=[];r.trials.forEach(a=>{const l=new Image;l.src=c.getAssets(`./assets/cro_minion/${a.name}.jpg`),l.onload=()=>{s.push(a.name),t.push({name:a.name,pos:{x:a.posX,y:a.posY},size:{width:l.width/10,height:l.height/10},domObj:l,isChoose:!1}),t.length==r.trials.length&&(this.initFunc(),this.data=new h(s))}}),this.imgs=t,this.dom=e,this.radius=250,this.mousePos={x:0,y:0},this.data=new h([])}initFunc(){this.reset_canvas_size(),this.data.reset()}reset_canvas_size(){const e=this.dom.parentElement;this.dom.width=e.clientWidth,this.dom.height=e.clientHeight}render_bg(e){e.beginPath(),e.arc(this.dom.width/2,this.dom.height/2,this.radius,0,Math.PI*2),e.fill(),e.stroke(),e.closePath()}render_img(e){this.imgs.forEach(t=>{e.drawImage(t.domObj,0,0,t.domObj.width,t.domObj.height,t.pos.x-t.size.width/2,t.pos.y-t.size.height/2,t.size.width,t.size.height)})}render_line(e){for(let t=0;t<this.imgs.length;t++){this.imgs[t].isChoose&&(e.beginPath(),e.moveTo(this.imgs[t].pos.x,this.imgs[t].pos.y),e.lineTo(this.mousePos.x,this.mousePos.y),e.stroke(),e.closePath());for(let s=t+1;s<this.imgs.length;s++){const a=this.imgs[t].name,l=this.imgs[s].name;this.data.getVal(a,l)&&(e.beginPath(),e.moveTo(this.imgs[t].pos.x,this.imgs[t].pos.y),e.lineTo(this.imgs[s].pos.x,this.imgs[s].pos.y),e.stroke(),e.closePath())}}}render(){const e=this.dom.getContext("2d");e.clearRect(0,0,this.dom.width,this.dom.height),e.fillStyle="#999",e.lineWidth=1,e.strokeStyle="#fff",this.render_bg(e),this.render_img(e),e.strokeStyle="#f00",e.lineWidth=5,this.render_line(e),window.requestAnimationFrame(()=>{this.render()})}get_activate_img(e){const t=[];return this.imgs.forEach(s=>{const a=Math.abs(e.x-s.pos.x),l=Math.abs(e.y-s.pos.y);a<s.size.width/2&&l<s.size.height/2&&t.push(s)}),t}onmouse(e,t){if(e=="up"){const s=["",""];this.get_activate_img(t).forEach(a=>{s[1]=a.name}),this.imgs.forEach(a=>{a.isChoose&&(s[0]=a.name),a.isChoose=!1}),this.data.setVal(s[0],s[1],1-this.data.getVal(s[0],s[1]))}else e=="down"?this.get_activate_img(t).forEach(s=>{s.isChoose=!0}):e=="move"&&(this.mousePos=t)}getKey(){return this.data.keys}getVal(){return this.data.val}}let d;E(()=>{const m=document.querySelector("canvas");d=new u(m),d.render();const e=t=>{const{top:s,left:a}=m.getBoundingClientRect(),{clientX:l,clientY:_}=t;return{y:_-s,x:l-a}};m.addEventListener("mousedown",t=>{d.onmouse("down",e(t))}),m.addEventListener("mouseup",t=>{d.onmouse("up",e(t))}),m.addEventListener("mousemove",t=>{d.onmouse("move",e(t))})});const g=()=>{n("endTrial",d.getKey(),d.getVal())},f=()=>{d.initFunc()};return(m,e)=>(w(),v("div",ae,[e[0]||(e[0]=y("canvas",null,null,-1)),y("div",{class:"button-box"},[y("div",{onClick:g},"继续"),y("div",{onClick:f},"重置")])]))}}),he=S(ce,[["__scopeId","data-v-e423258d"]]),de={},le={class:"end-exp"},ue={class:"content-box"};function me(i,o){return w(),v("div",le,[y("div",ue,[o[0]||(o[0]=V(" 实验结束 ")),U(i.$slots,"default",{},void 0)]),o[1]||(o[1]=y("div",{class:"footer"}," © Mupsy 技术支持 ",-1))])}const fe=S(de,[["render",me],["__scopeId","data-v-588ad5c0"]]),pe={id:"exp"},ge=b({__name:"default",setup(i){const o=L(),c=I(),r=W({display_element:"exp"}),n=[{type:x,choices:["NO_KEYS"],stimulus:"<span id='a1'>0</span>/<span id='a2'>1</span>",on_load(){o.isInit||(o.addAssets("./assets/cro_minion/baby.jpg"),o.addAssets("./assets/cro_minion/man.jpg"),o.addAssets("./assets/cro_minion/monster.jpg"),o.addAssets("./assets/cro_minion/short.jpg"),o.addAssets("./assets/cro_minion/tall.jpg")),o.startLoad();const h=document.querySelector("#a2"),u=document.querySelector("#a1"),d=setInterval(()=>{if(c.isInit&&o.isFinish)clearInterval(d),r.finishTrial({type:"init-function"});else{const{len:g,left:f,loading:m}=o.progress;h.innerText=g.toString(),u.innerText=(g-f+m).toFixed(2)}},100)}}];return n.push({type:x,choices:["NO_KEYS"],stimulus:"<div id='box'></div>",on_load(){let h=0;k(O(re,{roleName:["baby","man","monster","short","tall"],onEndTrial(u){u.forEach((d,g)=>{r.data.write(Object.assign({},d,{index:g,save:!0,trial_name:"freeSort"}))}),r.finishTrial({})},onDragEvent(u){h+=1,r.data.write(Object.assign({},u,{save:!0,index:h,trial_name:"freeSort_ing"})),console.log(2222)}}),document.querySelector("#box"))}}),n.push({type:x,choices:["NO_KEYS"],stimulus:"<div id='box'></div>",on_load(){const h=r.data.get().filter({save:!0}).last(5).values();k(O(he,{trials:h,onEndTrial(u,d){r.data.write({keys:u,vals:d,save:!0,trial_name:"freeLine"}),r.finishTrial({})}}),document.querySelector("#box"))}}),n.push({type:x,choices:["NO_KEYS"],stimulus:"<div id='box'></div>",on_load(){r.data.write(c.browser),new te().offlineSave(r.data.get().csv(),se()),k(O(fe),document.querySelector("#box"))}}),E(()=>{r.run(n)}),(h,u)=>(w(),v("div",pe))}}),_e=j({history:D("./"),routes:[{path:"/",name:"jspsych",component:ge,alias:"/exper"},{path:"/:pathMatch(.*)*",name:"not-found",component:()=>ee(()=>import("./index-BQQQa1dv.js"),__vite__mapDeps([0,1,2]),import.meta.url)}]}),ye=Y(),C=K(J);C.use(ye);C.use(_e);C.mount("#app");const T=H();T.switch("dark");document.body.classList.add(T.currScheme);export{S as _};
